!function(e){e.widget("ui.selectmenu",{_init:function(){var t=this,s=this.options;this.ids=[this.element.attr("id")+"-button",this.element.attr("id")+"-menu"],this._safemouseup=!0,this.newelement=e('<a class=" ui-widget  ui-corner-all '+this.widgetBaseClass+'" id="'+this.ids[0]+'" role="button" href="#" aria-haspopup="true" aria-owns="'+this.ids[1]+'"></a>').insertAfter(this.element);var i=this.element.attr("tabindex");i&&this.newelement.attr("tabindex",i),this.newelement.data("selectelement",this.element),this.selectmenuIcon=e('<span class="'+this.widgetBaseClass+'-icon ui-icon"></span>').prependTo(this.newelement).addClass("popup"==s.style?"ui-icon-triangle-2-n-s":"ui-icon-triangle-1-s"),e("label[for="+this.element.attr("id")+"]").attr("for",this.ids[0]).bind("click",function(){return t.newelement[0].focus(),!1}),this.newelement.bind("mousedown",function(e){return t._toggle(e),"popup"==s.style&&(t._safemouseup=!1,setTimeout(function(){t._safemouseup=!0},300)),!1}).bind("click",function(){return!1}).keydown(function(s){var i=!0;switch(s.keyCode){case e.ui.keyCode.ENTER:i=!0;break;case e.ui.keyCode.SPACE:i=!1,t._toggle(s);break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=!1,t._moveSelection(-1);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.RIGHT:i=!1,t._moveSelection(1);break;case e.ui.keyCode.TAB:i=!0;break;default:i=!1,t._typeAhead(s.keyCode,"mouseup")}return i}).bind("mouseover focus",function(){e(this).addClass(t.widgetBaseClass+"-focus ui-state-hover")}).bind("mouseout blur",function(){e(this).removeClass(t.widgetBaseClass+"-focus ui-state-hover")}),e(document).mousedown(function(e){t.close(e)}),this.element.click(function(){this._refreshValue()}).focus(function(){this.newelement[0].focus()});var a="dropdown"==s.style?" ui-corner-bottom":" ui-corner-all";this.list=e('<ul class="'+t.widgetBaseClass+"-menu ui-widget ui-widget-content"+a+'" aria-hidden="true" role="listbox" aria-labelledby="'+this.ids[0]+'" id="'+this.ids[1]+'"></ul>').appendTo("body");var n=[];this.element.find("option").each(function(){n.push({value:e(this).attr("value"),text:t._formatText(jQuery(this).text()),selected:e(this).attr("selected"),classes:e(this).attr("class"),parentOptGroup:e(this).parent("optgroup").attr("label")})});var o="popup"==t.options.style?" ui-state-active":"";for(var l in n){var d=e('<li role="presentation"><a href="#" tabindex="-1" role="option" aria-selected="false">'+n[l].text+"</a></li>").data("index",l).addClass(n[l].classes).data("optionClasses",n[l].classes||"").mouseup(function(s){if(t._safemouseup){var i=e(this).data("index")!=t._selectedIndex();t.value(e(this).data("index")),t.select(s),i&&t.change(s),t.close(s,!0)}return!1}).click(function(){return!1}).bind("mouseover focus",function(){t._selectedOptionLi().addClass(o),t._focusedOptionLi().removeClass(t.widgetBaseClass+"-item-focus ui-state-hover"),e(this).removeClass("ui-state-active").addClass(t.widgetBaseClass+"-item-focus ui-state-hover")}).bind("mouseout blur",function(){e(this).is(t._selectedOptionLi())&&e(this).addClass(o),e(this).removeClass(t.widgetBaseClass+"-item-focus ui-state-hover")});if(n[l].parentOptGroup){var r=t.widgetBaseClass+"-group-"+n[l].parentOptGroup;this.list.find("li."+r).size()?this.list.find("li."+r+":last ul").append(d):e('<li role="presentation" class="'+t.widgetBaseClass+"-group "+r+'"><span class="'+t.widgetBaseClass+'-group-label">'+n[l].parentOptGroup+"</span><ul></ul></li>").appendTo(this.list).find("ul").append(d)}else d.appendTo(this.list);if(this.list.bind("mousedown mouseup",function(){return!1}),s.icons)for(var h in s.icons)if(d.is(s.icons[h].find)){d.data("optionClasses",n[l].classes+" "+t.widgetBaseClass+"-hasIcon").addClass(t.widgetBaseClass+"-hasIcon");var u=s.icons[h].icon||"";d.find("a:eq(0)").prepend('<span class="'+t.widgetBaseClass+"-item-icon ui-icon "+u+'"></span>')}}if(this.list.find("li:last").addClass("ui-corner-bottom"),"popup"==s.style&&this.list.find("li:first").addClass("ui-corner-top"),s.transferClasses){var c=this.element.attr("class")||"";this.newelement.add(this.list).addClass(c)}var p=this.element.width();this.newelement.width(s.width?s.width:p),"dropdown"==s.style?this.list.width(s.menuWidth?s.menuWidth:s.width?s.width:p):this.list.width(s.menuWidth?s.menuWidth:s.width?s.width-s.handleWidth:p-s.handleWidth),s.maxHeight&&s.maxHeight<this.list.height()&&this.list.height(s.maxHeight),this._optionLis=this.list.find("li:not(."+t.widgetBaseClass+"-group)"),this.list.keydown(function(s){var i=!0;switch(s.keyCode){case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=!1,t._moveFocus(-1);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.RIGHT:i=!1,t._moveFocus(1);break;case e.ui.keyCode.HOME:i=!1,t._moveFocus(":first");break;case e.ui.keyCode.PAGE_UP:i=!1,t._scrollPage("up");break;case e.ui.keyCode.PAGE_DOWN:i=!1,t._scrollPage("down");break;case e.ui.keyCode.END:i=!1,t._moveFocus(":last");break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:i=!1,t.close(s,!0),e(s.target).parents("li:eq(0)").trigger("mouseup");break;case e.ui.keyCode.TAB:i=!0,t.close(s,!0);break;case e.ui.keyCode.ESCAPE:i=!1,t.close(s,!0);break;default:i=!1,t._typeAhead(s.keyCode,"focus")}return i}),"dropdown"==s.style?(this.newelement.addClass(t.widgetBaseClass+"-dropdown"),this.list.addClass(t.widgetBaseClass+"-menu-dropdown")):(this.newelement.addClass(t.widgetBaseClass+"-popup"),this.list.addClass(t.widgetBaseClass+"-menu-popup")),this.newelement.prepend('<span class="'+t.widgetBaseClass+'-status">'+n[this._selectedIndex()].text+"</span>"),this.element.hide(),1==this.element.attr("disabled")&&this.disable(),this.value(this._selectedIndex())},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled"),e("label[for="+this.newelement.attr("id")+"]").attr("for",this.element.attr("id")).unbind("click"),this.newelement.remove(),this.list.remove(),this.element.show()},_typeAhead:function(t,s){function i(t,i){o=!0,e(t).trigger(s),a._prevChar[1]=i}var a=this;a._prevChar||(a._prevChar=["",0]);var n=String.fromCharCode(t);c=n.toLowerCase();var o=!1;this.list.find("li a").each(function(t){if(!o){var s=e(this).text();(0==s.indexOf(n)||0==s.indexOf(c))&&(a._prevChar[0]==n?a._prevChar[1]<t&&i(this,t):i(this,t))}}),this._prevChar[0]=n},_uiHash:function(){return{value:this.value()}},open:function(e){var t=this,s=this.newelement.attr("aria-disabled");"true"!=s&&(this._refreshPosition(),this._closeOthers(e),this.newelement.addClass("ui-state-active"),this.list.appendTo("body").addClass(t.widgetBaseClass+"-open").attr("aria-hidden",!1).find("li:not(."+t.widgetBaseClass+"-group):eq("+this._selectedIndex()+") a")[0].focus(),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"),this._refreshPosition(),this._trigger("open",e,this._uiHash()))},close:function(e,t){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.list.attr("aria-hidden",!0).removeClass(this.widgetBaseClass+"-open"),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),t&&this.newelement[0].focus(),this._trigger("close",e,this._uiHash()))},change:function(e){this.element.trigger("change"),this._trigger("change",e,this._uiHash())},select:function(e){this._trigger("select",e,this._uiHash())},_closeOthers:function(t){e("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){e(this).data("selectelement").selectmenu("close",t)}),e("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},_toggle:function(e,t){this.list.is("."+this.widgetBaseClass+"-open")?this.close(e,t):this.open(e)},_formatText:function(e){return this.options.format?this.options.format(e):e},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},_moveSelection:function(e){var t=parseInt(this._selectedOptionLi().data("index"),10),s=t+e;return this._optionLis.eq(s).trigger("mouseup")},_moveFocus:function(e){if(isNaN(e))var t=parseInt(this._optionLis.filter(e).data("index"),10);else var s=parseInt(this._focusedOptionLi().data("index"),10),t=s+e;0>t&&(t=0),t>this._optionLis.size()-1&&(t=this._optionLis.size()-1);var i=this.widgetBaseClass+"-item-"+Math.round(1e3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id",""),this._optionLis.eq(t).find("a:eq(0)").attr("id",i)[0].focus(),this.list.attr("aria-activedescendant",i)},_scrollPage:function(e){var t=Math.floor(this.list.outerHeight()/this.list.find("li:first").outerHeight());t="up"==e?-t:t,this._moveFocus(t)},_setData:function(e,t){this.options[e]=t,"disabled"==e&&(this.close(),this.element.add(this.newelement).add(this.list)[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",t))},value:function(e){return arguments.length&&(this.element[0].selectedIndex=e,this._refreshValue(),this._refreshPosition()),this.element[0].selectedIndex},_refreshValue:function(){var e="popup"==this.options.style?" ui-state-active":"",t=this.widgetBaseClass+"-item-"+Math.round(1e3*Math.random());this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+e).find("a").attr("aria-selected","false").attr("id",""),this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+e).find("a").attr("aria-selected","true").attr("id",t);var s=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",i=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(s).data("optionClasses",i).addClass(i).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html()),this.list.attr("aria-activedescendant",t)},_refreshPosition:function(){this.list.css("left",this.newelement.offset().left);var t=this.newelement.offset().top,s=this.list[0].scrollTop;this.list.find("li:lt("+this._selectedIndex()+")").each(function(){s-=e(this).outerHeight()}),this.newelement.is("."+this.widgetBaseClass+"-popup")?(t+=s,this.list.css("top",t)):(t+=this.newelement.height(),this.list.css("top",t))}}),e.extend(e.ui.selectmenu,{getter:"value",version:"@VERSION",eventPrefix:"selectmenu",defaults:{transferClasses:!0,style:"popup",width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null}})}(jQuery);